"undefined"==typeof room&&(room={}),"undefined"==typeof room.utils&&(room.utils={}),$(function(){"use strict";function a(){return!document[e]}function b(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function c(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}var d=function(){var a="hidden",b=["webkit","moz","ms"];if(a in document)return"";a="Hidden";for(var c=0;c<b.length;c++)if(b+a in document)return b;return""}(),e=d?d+"Hidden":"hidden",f=d+"visibilitychange",g={log:function(){}},h={maxRetry:5,authCommand:"room.auth",authError:null,retryInterval:1e3,noopCommand:"noop",logger:g};c()&&(f="pageshow"),room.Connection=function(c){function d(a){if(t.log("request",a),!p())return void((z||A<c.maxRetry)&&(n(function(){d(a)}),z||(C=q())));c.onRequest&&c.onRequest(a.command,a.data);var b=(new Date).getTime(),e=++u;v[e]=b,a.success&&(w[e]=a.success),a.error&&(x[e]=a.error);var f={id:e,command:a.command,data:a.data};return a.log&&(f.log=a.log),C.send(JSON.stringify(f)),s}function e(a,b,c){return b&&(w[a]=b),c&&(x[a]=c),s}function g(a){return delete w[a],delete x[a],s}function i(a){function b(a){t.log("authError",c.url),A=c.maxRetry,c.authError&&c.authError(a)}z=!1,t.log("onOpen",c.url),c.onOpen&&c.onOpen(a),A=0,c.authToken&&d({command:c.authCommand,data:c.authToken,success:function(a){c.authToken=a},error:b});for(var e=0;e<y.length;e++)y[e]();y=[]}function j(a){t.log("receive",a.data),c.onMessage&&c.onMessage(a);var b=JSON.parse(a.data),d=v[b.id],e=null;d&&delete v[b.id],"error"==b.type?b.id&&x[b.id]?e=x[b.id]:b.command&&x[b.command]?e=x[b.command]:c.onServerError&&(e=c.onServerError):b.id&&w[b.id]?e=w[b.id]:b.command&&w[b.command]&&(e=w[b.command]),b.id&&(delete w[b.id],delete x[b.id]),e?e(b.data):"error"!=b.type&&t.log("UnknownMessage",a.data)}function k(d){function e(){return b()&&!a()?!1:A<c.maxRetry}t.log("close",c.url),c.onClose&&c.onClose(d),e()?(setTimeout(function(){p()||(C=q())},A*c.retryInterval),A++):B&&(clearInterval(B),B=0)}function l(a){c.onSocketError&&c.onSocketError(a)}function m(a,b){return setInterval(function(){p()&&d($.extend(!0,{},b))},a)}function n(a){p()?a():y.push(a)}function o(){p()&&(A=c.maxRetry,C.close())}function p(){return 1==C.readyState}function q(){z=!0;var a=new WebSocket(c.url);return a.onopen=i,a.onmessage=j,a.onerror=l,a.onclose=k,a}function r(b,c,e){return B&&clearInterval(B),B=setInterval(function(){p()&&(c||a())&&d({command:e||"noop"})},1e3*b)}"string"==typeof c&&(c={url:c}),c=$.extend({},h,c);var s=this,t=c.logger,u=0,v={},w={},x={},y=[],z=!1,A=0,B=0,C=q();$(window).on("beforeunload",o),$(document).on(f,function(){var b=a();t.log(f,"visible="+b),b&&!p()&&(C=q())}),c.noopCommand&&e(c.noopCommand,function(){}),$.extend(this,{request:d,addEventListener:e,removeEventListener:g,on:e,off:g,polling:m,ready:n,close:o,isConnected:p,sendNoop:r,onOpen:function(a){return c.onOpen=a,this},onClose:function(a){return c.onClose=a,this},onRequest:function(a){return c.onRequest=a,this},onMessage:function(a){return c.onMessage=a,this},onSocketError:function(a){return c.onSocketError=a,this},onServerError:function(a){return c.onServerError=a,this}})},$.extend(room.utils,{isIOS:c,isMobile:b,isDocumentVisible:a})}),"undefined"==typeof room&&(room={}),$(function(){room.Cache=function(a,b){function c(c){if(a)try{return a.getItem(c)}catch(d){b&&console&&console.log(d)}return null}function d(a){var b=c(a);return b&&(b=JSON.parse(b)),b}function e(c,d){if(a){"object"==typeof d&&(d=JSON.stringify(d));try{a.setItem(c,d)}catch(e){b&&console&&console.log(e)}}}function f(c){if(a)try{a.removeItem(c)}catch(d){b&&console&&console.log(d)}}function g(){var c=[];if(a)try{for(var d=0;d<a.length;d++)c.push(a.key(d))}catch(e){b&&console&&console.log(e)}return c}function h(){try{return sotrage?a.length:0}catch(c){b&&console&&console.log(c)}}function i(){if(a)try{a.clear()}catch(c){b&&console&&console.log(c)}}$.extend(this,{get:c,getAsJson:d,put:e,remove:f,size:h,clear:i,keys:g})}}),"undefined"==typeof room&&(room={}),"undefined"==typeof room.logger&&(room.logger={}),"undefined"==typeof room.utils&&(room.utils={}),$(function(){function a(b){var c=typeof b;if("object"!==c)return b;if($.isArray(b)){for(var d=[],e=0;e<b.length;e++)c=typeof b[e],d.push("function"===c?"(function)":"object"===c?a(b[e]):b[e]);return d}var f={};for(var g in b)c=typeof g,f[g]="function"===c?"(function)":"object"===c?a(b[g]):b[g];return f}room.logger.WsLogger=function(b,c){var d=new room.Connection(b);c=c||"log",this.log=function(){d.request({command:c,data:a(arguments)})}},room.logger.DivLogger=function(b){this.log=function(){for(var c=[],d=0;d<arguments.length;d++)c.push("object"==typeof arguments[d]?a(arguments[d]):arguments[d]);$("<p/>").text(JSON.stringify(c)).prependTo(b)}},room.logger.nullLogger={log:function(){}},$.extend(room.utils,{stripFunc:a})}),function(a){function b(){return!!a.fn.tooltip}function c(a,b){var c=b.back,d=b.fore,f=b.pattern;if(b.styleRef){var g=a.styles[b.styleRef].split("|");c=g[0],d=g[1],f=g[2]}d&&(e.fillStyle=d,e.fillRect(b.p[0],b.p[1],b.p[2],b.p[3]))}function d(a){var b=a.kind?a.kind:1,c=1,d=a.p[0],o=a.p[1],p=a.p[2],q=a.p[3],r=o==q;if(b==f||b==l||b==m||b==n?c=2:b==i&&(c=3),e.lineWidth=c,1==c||3==c?r?(o=0==o?.5:o-.5,q=0==q?.5:q-.5):(d=0==d?.5:d-.5,p=0==p?.5:p-.5):r&&0==o?(o=1,q=1):r||0!=d||(d=1,p=1),e.strokeStyle=a.color?a.color:"#000000",b==j)e.beginPath(),r?(e.moveTo(d,o-1),e.lineTo(p,q-1),e.moveTo(d,o+1),e.lineTo(p,q+1)):(e.moveTo(d-1,o),e.lineTo(p-1,q),e.moveTo(d+1,o),e.lineTo(p+1,q)),e.stroke(),e.closePath();else if(b==g||b==h||b==k||b==l){var s,t;switch(b){case g:s=4,t=2;break;case h:s=2,t=2;break;case k:s=1,t=1;break;case l:s=8,t=3}var u=!0;if(e.beginPath(),e.moveTo(d,o),r)for(var v=o,w=d,x=p;x>w;){var y=u?s:t;w+=y,w>x&&(w=x),u?e.lineTo(w,v):e.moveTo(w,v),u=!u}else for(var z=d,A=o,B=q;B>A;){var C=u?s:t;A+=C,A>B&&(A=B),u?e.lineTo(z,A):e.moveTo(z,A),u=!u}e.stroke(),e.closePath()}else e.beginPath(),e.moveTo(d,o),e.lineTo(p,q),e.stroke(),e.closePath()}var e,f=2,g=3,h=4,i=5,j=6,k=7,l=8,m=10,n=12;a.fn.excelToCanvas=function(f,g){var h,i;if("canvas"==this[0].tagName?(i=this,h=i.parent()):(h=this,i=h.find("canvas"),0==i.length&&(i=a("<canvas style='position:absolute;left:0;top:0;z-index:0'></canavas>").appendTo(h))),"undefined"!=typeof FlashCanvas&&FlashCanvas.initElement(i[0]),i.attr("width",f.width).attr("height",f.height),h.css({width:f.width,height:f.height}),e=i[0].getContext("2d"),e.fillStyle="white",e.fillRect(0,0,f.width,f.height),f.font&&(e.font=f.font),f.fills)for(var j=0;j<f.fills.length;j++){var k=f.fills[j];c(f,k)}if(f.lines)for(var j=0;j<f.lines.length;j++){var l=f.lines[j];d(l)}if(f.strs)for(var j=0;j<f.strs.length;j++){var m=f.strs[j],n=m.style?m.style:f.styles[m.styleRef],o=a("<span style='"+n+"'></span>");if(m.link){var p=a("<a target='_blank'></a>");p.append(m.text),p.attr("href",m.link),o.append(p)}else o.append(m.text);var q=m.align;if(q&&(o.addClass("cell-a"+q[0]),o.addClass("cell-v"+q[1]),"c"==q[1]||"j"==q[1])){var r=m.text.split("<br>").length;r>1&&o.css("margin-top","-"+r/2+"em")}m.rawdata&&o.attr("data-raw",m.rawdata);var s=a("<div id='"+m.id+"' class='cell'></div>").append(o);s.css({left:m.p[0],top:m.p[1],width:m.p[2],height:m.p[3]}),m.clazz&&s.addClass(m.clazz),m.dataAttrs&&a.each(m.dataAttrs,function(a,b){s.attr("data-"+a,b)}),m.comment&&b()&&(e.strokeStyle="red",e.fillStyle="red",e.beginPath(),e.moveTo(m.p[0]+m.commentWidth-4,m.p[1]),e.lineTo(m.p[0]+m.commentWidth,m.p[1]),e.lineTo(m.p[0]+m.commentWidth,m.p[1]+4),e.lineTo(m.p[0]+m.commentWidth-4,m.p[1]),e.stroke(),e.fill(),e.closePath(),s.tooltip({title:m.comment,html:!0})),h.append(s)}if(f.pictures)for(var j=0;j<f.pictures.length;j++){var t=f.pictures[j],u=a("<img class='excel-img'/>");u.attr("src",t.uri),u.css({left:t.p[0],top:t.p[1],width:t.p[2],height:t.p[3]}),h.append(u)}if(f.charts&&a.fn.excelToChart)for(var j=0;j<f.charts.length;j++){var v=f.charts[j],w={},x=a("<div class='excel-chart'></div>");x.css({left:v.p[0],top:v.p[1],width:v.p[2],height:v.p[3]}),h.append(x),f.font&&(w.HtmlText=!0),x.excelToChart(v.chart,w),x.css("position","absolute")}if(g)for(var y in g){var s=a("#"+y);if(s.length>0){var z=g[y];if("string"==typeof z)s.find("span").text(z);else if(z.element){var A=a(document.createElement(z.element));for(attr in z)"element"!=attr&&A.attr(attr,z[attr]);s.css("overflow","visible").empty().append(A)}}}return this}}(jQuery),"undefined"==typeof flect&&(flect={}),function(a){"use strict";function b(b){for(var c=0;c<b.length;c++){var d=b[c],e=r[d.name];e||(e=d.name),d.text=e,this[d.name]=d}a.extend(this,{fromName:function(a){for(var c=0;c<b.length;c++)if(b[c].name==a)return b[c];return null}})}function c(b){if(!b)return!1;var c=b.constructor.name;return c?"FormData"===c:!a.isPlainObject(b)}function d(b){return a.isNumeric(b.replace(/,/g,""))}function e(){s.debug&&console.log.apply(console,arguments)}function f(a,b){return a.baseUrl+"/"+a.contextUrl+b}function g(a,b){a.headers={"X-Auth-Token":b}}function h(b,c){function d(){e.hide(),f.unbind("change blur",d)}var e=null,f=a(this);switch(b){case"prompt":e=new j(c.title,c.text,!1),f.bind("change blur",d);break;case"error":e=new j(c.title,c.text,!0),f.addClass("exrep-error"),f.change(d);break;case"modified":f.removeClass("exrep-error")}e&&e.show(f)}function i(b){function c(a){return a.match(/[A-Z]+/)[0]}function d(a,b){var d=a.indexOf(":");if(-1==d)return b==a;var e=a.substring(0,d),f=a.substring(d+1),g=c(e),h=parseInt(e.substring(g.length)),i=c(f),j=parseInt(f.substring(i.length)),k=c(b),l=parseInt(b.substring(k.length));return k>=g&&i>=k&&l>=h&&j>=l}function e(c,e){var f=null,g=null;return a.each(b,function(a,b){return a==c?(f=b,!1):!0}),f&&a.each(f,function(a,b){for(var c=0;c<b.regions.length;c++)if(d(b.regions[c],e))return g=b,!1;return!0}),g}function f(b,c){var d=e(b,c),f=null;if(!d)return null;if(d.vt===o){var h=a("<select><option value=''></option></select>");return a.each(d.list,function(b,c){var d=a("<option/>");d.attr("value",c),d.text(c),h.append(d)}),h}return g(d)?(f=a("<input type='number'/>"),f.css("text-align","right"),f):d.vt===p?(f=a("<input type='date'/>"),f.css("text-align","right"),f):d.vt===q?(f=a("<input type='time'/>"),f.css("text-align","right"),f):null}function g(a){return a.vt==m||a.vt==n}function h(){var b=a(this),c=b.attr("name"),d=b.parent("div").attr("id"),f=e(c,d);f&&f.prompt&&s.onRule.call(this,"prompt",f.prompt)}a.extend(this,{rules:b,buildInput:f,onFocus:h})}function j(b,c,d){function e(a){var c=a.parent("div"),e=c.position(),f=e.top,h=e.left+20;d?f+=a.height()+10:f-=b?60:35,g.appendTo(c.parent()).css({top:f,left:h}).show()}function f(){g.hide()}var g=d?v:u,h=null,i=a("<div class='exrep-popup-content'/>");g.empty(),b&&(h=a("<div class='exrep-popup-title'/>"),h.text(b),g.append(h),d&&a("<div class='exrep-popup-close'>Ã—</div>").appendTo(h).click(f)),i.text(c),g.append(i),a.extend(this,{show:e,hide:f})}function k(b,c){function d(){if(0===b.find("button").length){var d=c.top,e=c.left;"center"==d&&(d=(a(window).height()-c.height)/2),"center"==e&&(e=(a(window).width()-c.width)/2),b.empty().css({display:"none",position:"fixed",top:d,left:e,width:c.width,height:c.height,border:"solid 1px #000000","background-color":"#F0F0F0","text-align":"center","z-index":1e3}).append("<div style='margin:10px 0'><img src='"+c.baseUrl+"/assets/images/loading.gif'/></div><div style='margin:10px 0'><span>"+t.Prepared.text+"...</span></div><div style='margin-right:10px;text-align:right'><button class='btn btn-warning'>"+r.Cancel+"</button></div><form action='#' method='post'></form>")}j=b.find("span"),k=b.find("form"),l=b.find("button"),l.unbind("click")}function e(){b.show()}function g(){b.hide()}function h(a){j.text(a)}function i(a){k.attr("action",f(c,"/finish/"+a)).submit()}var j,k,l;d(),a.extend(this,{show:e,close:g,text:h,download:i,cancelButton:l})}function l(b,d,e){function h(){var b="excelReport-download-dialog",c=a("#"+b);0===c.length&&(c=a("<div/>"),c.attr("id",b),a("body").append(c)),p=new k(c,e),p.cancelButton.click(l)}function i(h,i){o=null,n=!1,q=i;var k={url:f(e,"/prepare/"+b+"/"+d),type:"POST",data:h,success:function(a){var b=t.fromName(a.status);b==t.Error?e.error(a.msg):b==t.Prepared?(o=a.ticket,e.showLoading&&p.show(),setTimeout(j,5e3)):(console.log("Unknown data",a),e.error(JSON.stringify(a)))},error:function(a,b,c){e.error(b+", "+c)}};e.apikey&&g(k,e.apikey),c(h)&&(k.processData=!1,k.contentType=!1),a.ajax(k)}function j(){o&&!n&&a.ajax({url:f(e,"/status/"+o),type:"GET",success:function(a){var b=t.fromName(a.status);b==t.Prepared||b==t.Processing?(p.text(b.text+"..."),setTimeout(j,1e3)):b==t.Finished?(p.close(),isUpload()?m():p.download(o)):b==t.Error?(p.close(),e.error(a.msg)):b==t.Canceled?p.close():(console.log("Unknown data",a),e.error(JSON.stringify(a)))},error:function(a,b,c){e.error(b+", "+c)}})}function l(){o&&!n&&(n=!0,a.ajax({url:f(e,"/cancel/"+o),type:"GET",success:function(a){console.log("Cancel: "+a)},error:function(a,b,c){e.error(b+", "+c)}}),p.close())}function m(){o&&!n&&a.ajax({url:f(e,"/finish/"+o),type:"GET",success:function(a){q&&q(a)},error:function(a,b,c){e.error(b+", "+c)}})}e=a.extend(s,e||{});var n=!1,o=null,p=null,q=null;h(),a.extend(this,{prepare:i})}var m=1,n=2,o=3,p=4,q=5,r={Prepared:"Preparing",Processing:"Processing",Finished:"Finished",Error:"Error",Canceled:"Canceled",Cancel:"Cancel"},s={baseUrl:"",contextUrl:"download",showLoading:!0,width:320,height:120,top:"center",left:"center",debug:!1,error:function(a){alert(a)},onRule:h};flect.excelreport&&flect.excelreport.MSG&&(r=a.extend(r,flect.excelreport.MSG));var t=new b([{name:"Prepared"},{name:"Processing"},{name:"Finished"},{name:"Error"},{name:"Canceled"}]),u=a("<div class='exrep-popup' style='display:none;'/>"),v=a("<div class='exrep-popup exrep-popup-error' style='display:none;'/>");flect.ExcelReport=function(b,f,h,j,k,l){function m(){var a="excelreport-"+h+"-"+j;return k&&(a+="-"+k),a}function n(a){var b=a.attr("data-name"),c=a.prev("div:eq(0)"),d=a.next("div:eq(0)");return c.attr("data-name")==b||d.attr("data-name")==b}function o(){function c(b){var c=a("<span style='display:none;'/>"),d=0;return c.text(b.text()),b.parent().append(c),d=c.width(),c.remove(),d}e("ExcelReport.buildForm"),b.find(".namedCell").each(function(){var b=a(this),d=b.find("span"),e=b.attr("id"),f=b.attr("data-name"),g=d.text(),h=!!b.attr("data-formula");if(!h){var i=l.buildInput?l.buildInput(f,e):null,j=b.innerHeight(),k=b.innerWidth();if(null===i&&C&&(i=C.buildInput(f,e)),null===i&&(j>40?i=a("<textarea></textarea>"):(i=a("<input type='text'/>"),d.hasClass("cell-ar")?i.css("text-align","right"):d.hasClass("cell-ac")&&i.css("text-align","center"))),"string"!=typeof i){if(g)if(n(b))i.val(g),d.remove();else{var m=c(d);k-=m+4,d.css("width",m+8+"px"),i.css("margin-left",m+8+"px")}else d.remove();i.css({width:k-8+"px",height:j-2+"px"}),i.addClass("exrep-input"),i.attr("name",f),C&&i.focus(C.onFocus)}b.append(i)}}),z&&b.find(":input").change(function(){var b=a(this),c=b.parent("div"),d=c.attr("id"),e=b.attr("name"),f=b.val();z.request({command:"modified",data:{id:d,name:e,value:f},success:function(a){"OK"==a?s.onRule.call(b[0],"modified",f):s.onRule.call(b[0],"error",a)}})}),v()}function p(){function c(){var b="",c=s.lang||a("html").attr("lang")||"";return f?0===f.indexOf("https:")?b="wss"+f.substring(5):0===f.indexOf("http:")?b="ws"+f.substring(4):0===f.indexOf("//")?b=("https:"==location.protocol?"wss":"ws")+":"+f:s.error("Invalid baseUrl: "+f):b=("https:"==location.protocol?"wss":"ws")+"://"+location.host,b+="/liveform/"+h+"/"+j,c&&(b+="?language="+c),b}e("ExcelReport.openConnection");var g={url:c()},k=null===z;s.debug&&(g.logger=console),z=new room.Connection(g),z.on("calced",function(b){a.each(b,function(b,c){var e=a("#"+b+" span");e.empty().append(c),d(c)&&!e.hasClass("cell-ac")&&e.removeClass("cell-al").addClass("cell-ar")})}),z.on("chart",function(c){if(a.fn.excelToChart){var d=c.chart,e=b.find(".excel-chart").eq(c.index);e.excelToChart(d),e.css("position","absolute")}}),z.onOpen(function(){k?z.request({command:"available",data:{rules:null===C},success:function(a){a.error?(alert(a.error),z.close(),z=null):(A=a.license,C||(C=new i(a.rules)),l.form&&o())}}):b.excelReport("update",b.excelReport("data"))}),z.sendNoop(30,!room.utils.isMobile())}function q(b){e("ExcelReport.getInfo"),a.ajax({url:f+"/report/info/"+h+"/"+j,success:b})}function r(b){e("ExcelReport.show");var c=b&&!a.isEmptyObject(b);if(l.cache&&!c){var d=x.getAsJson(m());if(d)return void q(function(a){return y=a.lastModified,a.lastModified==d.lastModified&&(d.rules&&(C=new i(d.rules)),d.json)?(B=d.json,void u(B)):void t(b,c)})}t(b,c)}function t(d,i){e("ExcelReport.loadJson");var m={url:f+"/report/json/"+h+"/"+j,type:"POST",data:d,success:function(a,c,d){var e=d.getResponseHeader("content-type")||"json";-1!=e.indexOf("json")?(i||(B=a),u(a)):-1!=e.indexOf("html")&&b.html(a)}};k&&(m.url+="/"+k),c(d)&&(m.processData=!1,m.contentType=!1),apikey&&g(m,l.apikey),a.ajax(m)}function u(a){e("ExcelReport.showJson"),b.excelToCanvas(a),l.live?p():l.form?o():v()}function v(){if(e("ExcelReport.finish"),"Free"==A){var c=a("<img/>");c.attr("src",f+"/assets/images/PoweredByExcelReport.png"),c.css({position:"absolute",right:0,bottom:0,"z-index":1e3}),c.addClass("exrep-logo"),b.append(c)}if(l.callback&&l.callback(b,data),l.cache&&(B||C)){var d={};B&&(d.json=B),C&&(d.rules=C.rules),y?(d.lastModified=y,x.put(m(),d)):q(function(a){d.lastModified=a.lastModified,x.put(m(),d)})}}function w(){e("ExcelReport.release"),z&&z.close(),x=null,y=null,z=null,A=null,B=null,C=null}e("ExcelReport.init",h,j,k);var x=new room.Cache(localStorage),y=null,z=null,A=null,B=null,C=null;a.extend(this,{show:r,release:w})},a.fn.excelReport=function(b,c,e){function f(b,c){var d={};return a.each(c,function(c,e){var f=b.find("#"+c);if(f.length)d[c]=e;else if(f=b.find("[data-name="+c+"]"),f.length)if(a.isArray(e)){var g=0;f.each(function(){var b=a(this),c=b.attr("id"),f=b.attr("data-formula");return f||(d[c]=e[g++]),g<e.length})}else{var h=a(f.get(0)).attr("id");d[h]=e}}),d}function g(b,c){var d=c.baseUrl||s.baseUrl,e=c.user,f=c.template,g=c.sheet,h=c.data,i=b.css("position"),j=a.data(b.get(0),"report"),k={apikey:c.apikey,form:c.form,live:c.live,cache:c.cache,callback:c.callback,buildInput:c.buildInput};"static"===i&&b.css("position","relative"),j&&(j.release(),a.removeData(b.get(0),"report")),j=new flect.ExcelReport(b,d,e,f,g,k),j.show(h),a.data(b.get(0),"report",j)}function h(b,c){var d={};if(b.find(":input").each(function(){var b=a(this),c=b.attr("name"),e=b.val(),f=d[c],g=typeof f;if("undefined"===g)d[c]=e;else if("string"===g){var h=[];h.push(f),h.push(e),d[c]=h}else f.push(e)}),!c){var e=[];for(var f in d){var g=d[f];if(a.isArray(g)){for(;g.length>0&&!g[g.length-1];)g.pop();0===g.length&&e.push(f)}else g||e.push(f)}for(var h=0;h<e.length;h++)delete d[e[h]]}return d}function i(b,c,e){var g=c,h=a.data(b.get(0),"connection");"string"==typeof c&&"undefined"!=typeof e&&(g={},g[c]=e),g=f(b,g),a.each(g,function(a,c){var e=b.find("#"+a);if(e.length){var f=e.find(":input");if(f.length)f.val(c);else{var g=e.find("span");g.text(c),d(""+c)&&!g.hasClass("cell-ac")&&g.removeClass("cell-al").addClass("cell-ar")}}}),h&&h.request({command:"updateCells",data:g})}function j(b,c,d){var e="form"==b[0].tagName.toLowerCase(),f=e?new FormData(b[0]):h(b),g=a.extend({},d);g.data=f,a.excelReport(c,g)}switch("object"==typeof b&&(c=b,b="show"),b){case"show":case"showExcel":return g(this,c),this;case"data":return h(this,!!c);case"update":case"updateCells":return i(this,c,e),this;case"pdf":case"downloadPdf":j(this,b,c);break;case"excel":case"downloadExcel":j(this,b,c);break;default:throw"Unknown method: "+b}},a.excelReport=function(b,d){function e(b){"string"==typeof b&&(b={baseUrl:b}),b.msg&&(a.extend(r,b.msg),delete b.msg),a.extend(s,b)}function f(b,d){function e(a,b){c(h)?h.append(a,b):h[a]=b}var f=b.user,g=b.template,h=b.data,i=a.extend({},b);delete i.user,delete i.template,delete i.data,i.baseUrl||(i.baseUrl=s.baseUrl),d&&i.pdf&&(a.each(i.pdf,function(a,b){e("pdf."+a,b)}),delete i.pdf),i.filename&&(e("filename",i.filename),delete i.filename),i.contextUrl=d?"pdf":"download",new l(f,g,i).prepare(h)}switch("object"==typeof b&&(d=b,b="configure"),b){case"configure":e(d);break;case"pdf":case"downloadPdf":f(d,!0);break;case"excel":case"downloadExcel":f(d,!1);break;default:throw"Unknown method: "+b}}}(jQuery);